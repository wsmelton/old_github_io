<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Shawn Melton">
<meta name="description" content="I have had a thought on how I might write this function for some time and finally decided to just sit down and do it.
When you have alerts setup or just in general need to troubleshoot a given instance of SQL Server one of the first steps is always looking through the ERRORLOG files for the instance. You can do this via SSMS or even via T-SQL with a known (but undocumented) stored procedure sp_readerrorlog.">

<meta property="og:title" content="Search-SqlErrorLog" />
<meta property="og:description" content="I have had a thought on how I might write this function for some time and finally decided to just sit down and do it.
When you have alerts setup or just in general need to troubleshoot a given instance of SQL Server one of the first steps is always looking through the ERRORLOG files for the instance. You can do this via SSMS or even via T-SQL with a known (but undocumented) stored procedure sp_readerrorlog." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.wsmelton.info/blog/search-sqlerrorlog/" /><meta property="article:published_time" content="2014-12-22T08:00:00-06:00"/>
<meta property="article:modified_time" content="2018-05-13T19:43:27-05:00"/>

<title>


     Search-SqlErrorLog 

</title>
<link rel="canonical" href="https://blog.wsmelton.info/blog/search-sqlerrorlog/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/darcula.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="/css/reset.css?t=2018-08-24%2012%3a28%3a35.2042317%20%2b0000%20GMT%20m%3d%2b0.519361801">
    <link rel="stylesheet" href="/css/pygments.css?t=2018-08-24%2012%3a28%3a35.2042317%20%2b0000%20GMT%20m%3d%2b0.519361801">
    <link rel="stylesheet" href="/css/main.css?t=2018-08-24%2012%3a28%3a35.2042317%20%2b0000%20GMT%20m%3d%2b0.519361801">
    




<link rel="shortcut icon"

    href="/img/favicon.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
                
                
                
                
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                
                <a href="/"><img class="avatar" src="/img/myavatar.jpg" srcset="https://blog.wsmelton.info/img/myavatar.jpg 1x"></a>
            
            <a href="/"><div class="name">Shawn Melton</div></a>
            
            <nav>
                <ul>
                    
                        <li class="nav-"><a href="https://blog.wsmelton.info/"><span>latest</span></a></li>
                    
                        <li class="nav-"><a href="https://blog.wsmelton.info/blog"><span>all</span></a></li>
                    
                        <li class="nav-about"><a href="https://blog.wsmelton.info/aboutme/"><span>about</span></a></li>
                    
                        <li class="nav-tags"><a href="https://blog.wsmelton.info/tags"><span>tags</span></a></li>
                    
                        <li class="nav-projects"><a href="https://blog.wsmelton.info/projects/"><span>projects</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/wsmelton" target="_blank" rel="noopener"><img class="icon" src="/img/github.svg" alt="github" /></a>
        

        
            <a href="//twitter.com/wsmelton" target="_blank" rel="noopener"><img class="icon" src="/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        
            <a href="//linkedin.com/in/wshawnmelton" target="_blank" rel="noopener"><img class="icon" src="/img/linkedin.svg" alt="linkedin" /></a>
        

        

        

        

        

        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    Search-SqlErrorLog

</div>

                    <div class="initials"><a href="https://blog.wsmelton.info/"></a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Mon 22 Dec 2014 08:00 CDT'>22 Dec 2014</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>3 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                <p>I have had a thought on how I might write this function for some time and finally decided to just sit down and do it.</p>

<p>When you have alerts setup or just in general need to troubleshoot a given instance of SQL Server one of the first steps is always looking through the ERRORLOG files for the instance. You can do this via SSMS or even via T-SQL with a known (but undocumented) stored procedure <a href="http://www.mssqltips.com/sqlservertip/1476/reading-the-sql-server-log-files-using-tsql/" target="_blank"><code>sp_readerrorlog</code></a>. Either of these methods is useful if you are just looking through one log at a time. However, I configure most of the servers I manage to keep at least 15 error logs. I have a few that are set to the max at 99. Trying to search through all of those for one phrase or word can be extremely time consuming to do manually. I guess you could do this with T-SQL, but this is one of those things that PowerShell shines at by allowing more flexibility. I can easily wrap this function into a few lines that will allow me to search for a phrase against multiple servers all at once.</p>

<p>The script is provided below and includes help information so you can use the help cmdlet to pull out the examples or information about each parameter.</p>

<pre><code class="language-powershell">function Search-SqlErrorLog
{
&lt;#
    .SYNOPSIS
        Allows you to search the error logs of a given SQL Server instance
    .DESCRIPTION
        Utilizes enumeration methods within SMO to iterate through all or some of the error logs on an instance
    .PARAMETER server
        the SQL Server instance
    .PARAMETER logNumber
        number of the specific error log you want to search, or an array of them
    .PARAMETER all
        switch to indicate just search through all error logs of the instance, this is default
    .EXAMPLE
    Search-SqlErrorLog -server MyServer -value &quot;Severity: 25&quot;
    Searches all the logs of an instance for the text &quot;Severity: 25&quot;
    .EXAMPLE
    Search-SqlErrorLog -server MyServer -lognumber 0 -value &quot;Severity: 25&quot;
    Searches through latest error log of an instance for the text &quot;Severity: 25&quot;
    .EXAMPLE
    Search-SqlErrorLog -server MyServer -lognumber 2,5 -value &quot;Severity: 25&quot;
    Searches through two specific error logs for an instance for the text &quot;Severity: 25&quot;
#&gt;

    [CmdletBinding()]
    param (
        [Parameter(Mandatory = $true,Position = 0)]
        [ValidateNotNull()]
        [Alias(&quot;instance&quot;)]
        [string]$server,

        [Parameter(Mandatory = $false,Position = 1)]
        [AllowNull()]
        [int[]]$lognumber,

        [Parameter(Mandatory = $false,Position = 2)]
        [AllowNull()]
        [switch]$all = $true,

        [Parameter(Mandatory = $true,Position = 3)]
        [ValidateNotNull()]
        [string]$value
    )

    $s = New-Object Microsoft.SqlServer.Management.Smo.Server $server

if ($all)
    {
        $collection = $s.EnumErrorLogs() | select -ExpandProperty name
        for ($i = 1; $i -lt $collection.Count; $i++)
        {
            Write-Progress -Activity &quot;Reading logs&quot; -Status &quot;Reading log number $i&quot; -PercentComplete ($i / $collection.Count * 100)
        }
        foreach ($l in $collection)
        {
            $s.ReadErrorLog($l) | where { $_.Text -match $value } | select @{Label=&quot;LogNumber&quot;;Expression={$l}}, LogDate, ProcessInfo, Text
        }
    }
    else
    {
        if ($lognumber.Count -eq 1)
        {
            $s.ReadErrorLog($lognumber) | where { $_.Text -match $value } | select LogDate, ProcessInfo, Text
        }
        elseif ($logNumber.Count -gt 0)
        {
            for ($i = 1; $i -lt $logNumber.Count; $i++)
            {
                Write-Progress -Activity &quot;Reading logs&quot; -Status &quot;Reading log number $i&quot; -PercentComplete ($i / $logNumber.Count * 100)
            }
            foreach ($l in $lognumber)
            {
                $s.ReadErrorLog($l) | where { $_.Text -match $value } | select LogDate, ProcessInfo, Text
            }
        }
    }
}
</code></pre>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="/tags/powershell">powershell</a>
                  
                    <a href="/tags/sqlserver">sqlserver</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="/blog/">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                
            </div>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-85098649-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

